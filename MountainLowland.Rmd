---
title: "Subsetting Mountains and Lowlands"
author: "us"
date: "7/25/2019"
output: html_document
---

#Add continental and mountainous outlines
```{r, message=FALSE}
nw_mount <- shapefile("Data/MapOutlines/Mountains/Koeppen-Geiger_biomes.shp")
nw_bound <- shapefile("Data/MapOutlines/Global_bound/Koeppen-Geiger_biomes.shp")

LongLatBetaRaster <- readRDS("Data/LongLatBetaRaster.rds")
RichnessRaster <- readRDS("Data/RichnessRaster.rds")
```


#Creates dataframe including coordinates for each
```{r}
LongLatRaster <- setValues(BlankRas, CellVec)
LongLatPoints<-rasterToPoints(LongLatRaster)
LongLatDF <- data.frame(LongLatPoints)
colnames(LongLatDF) <- c("Longitude", "Latitude", "CellID")

coordinates(LongLatDF) <- ~Longitude+Latitude 
proj4string(LongLatDF) <- CRS("+proj=utm +zone=10") 
LongLat <- spTransform(LongLatDF, CRS("+proj=longlat")) 
LongLatDF <- data.frame(LongLat)
LongLatDF[c("Longitude", "Latitude", "CellID")]
LongLatDF <- subset(LongLatDF, select = -c(optional))
saveRDS(LongLatDF, "Data/LongLatDF.rds")
```


#Scatterplot of beta diversity values of cells whose centers are within mountainous regions 
```{r, warning = FALSE}
LongLatDF <- readRDS("Data/LongLatDF.rds")
BetaMount <- extract(LongLatBetaRaster, nw_mount, df = TRUE, cellnumbers = TRUE)
BetaMount <- subset(BetaMount, select = -c(ID))

colnames(BetaMount) <- c("CellID", "Beta")
BetaMountVec <- BetaMount$CellID
BetaMount <- merge(BetaMount, LongLatDF)

BetaMountScatterplot <- ggplot(BetaMount, aes(Latitude, Beta)) + geom_point(shape = 16, size = 5, show.legend = FALSE, alpha=0.5, color = "goldenrod2") + ylab("Mountainous β diversity") + ylim(0.3, 1.0) + xlab("Latitude") + theme_minimal() +  theme(axis.title.y = element_text(size=32), axis.title.x = element_text(size=32),  axis.text = element_text(size=20))
BetaMountScatterplot
```


#Scatterplot of beta diversity values of cells in lowland areas 
```{r, warning = FALSE}
LongLatDF <- readRDS("Data/LongLatDF.rds")

BetaBound <- extract(LongLatBetaRaster, nw_bound, df = TRUE, cellnumbers = TRUE)
BetaBound <- subset(BetaBound, select = -c(ID))
colnames(BetaBound) <- c("CellID", "Beta")

BetaMatch <- BetaBound[BetaBound$CellID %in% BetaMountVec, ]
BetaMatchVec <- BetaMatch[, "CellID"]
BetaLowland <- BetaBound[!BetaBound$CellID %in% BetaMatchVec, ]

BetaLowlandVec <- BetaLowland$CellID
BetaLowland <- merge(BetaLowland, LongLatDF)

BetaLowlandScatterplot <- ggplot(BetaLowland, aes(Latitude, Beta)) + geom_point(shape = 16, size = 5, show.legend = FALSE, alpha=0.5, color = "cyan4") + ylab("β diversity") + ylim(0.3, 1.0) + xlab("Latitude") + theme_minimal() + theme(axis.title.y = element_text(size=32), axis.title.x = element_text(size=32),  axis.text = element_text(size=20))
BetaLowlandScatterplot

png("Figures/BetaMountainLowlandScatter.png", width = 1000, height = 1000, pointsize = 20)
grid.arrange(BetaMountScatterplot, BetaLowlandScatterplot, ncol=1)
dev.off()
```



#Scatterplot of alpha diversity values of cells whose centers are within mountainous regions 
```{r, warning = FALSE}
LongLatDF <- readRDS("Data/LongLatDF.rds")

AlphaMount <- extract(RichnessRaster, nw_mount, df = TRUE, cellnumbers = TRUE)
AlphaMount <- subset(AlphaMount, select = -c(ID))
colnames(AlphaMount) <- c("CellID", "Alpha")
AlphaBoundVec <- AlphaMount[, "CellID"]
AlphaMount <- merge(AlphaMount, LongLatDF)

AlphaMountScatterplot <- ggplot(AlphaMount, aes(Latitude, Alpha)) + geom_point(shape = 16, size = 5, show.legend = FALSE, alpha=0.5, color = "goldenrod2") + ylab("Mountainous α diversity") + ylim (0, 800) + xlab("Latitude") + theme_minimal() + theme(axis.title.y = element_text(size=32), axis.title.x = element_text(size=32),  axis.text = element_text(size=20))
AlphaMountScatterplot

png("Figures/AlphaBetaMountScatter.png", width = 1000, height = 1000, pointsize = 20)
grid.arrange(AlphaMountScatterplot, BetaMountScatterplot, ncol = 1)
dev.off()
```


#Scatterplot of alpha diversity values of cells in lowland areas 
```{r, warning = FALSE}
LongLatDF <- readRDS("Data/LongLatDF.rds")

AlphaBound <- extract(RichnessRaster, nw_bound, df = TRUE, cellnumbers = TRUE)
AlphaBound <- subset(AlphaBound, select = -c(ID))
colnames(AlphaBound) <- c("CellID", "Alpha")

AlphaMatch <- AlphaBound[AlphaBound$CellID %in% AlphaBoundVec, ]
AlphaMatchVec <- AlphaMatch[, "CellID"]
AlphaLowland <- AlphaBound[!AlphaBound$CellID %in% AlphaMatchVec, ]

AlphaLowlandVec <- AlphaLowland$CellID
AlphaLowland <- merge(AlphaLowland, LongLatDF)

AlphaLowlandScatterplot <- ggplot(AlphaLowland, aes(Latitude, Alpha)) + geom_point(shape = 16, size = 5, show.legend = FALSE, alpha=0.5, color = "cyan4") + ylab("Lowland α diversity") + ylim(0, 800) + xlab("Latitude") + theme_minimal() + theme(axis.title.y = element_text(size=32), axis.title.x = element_text(size=32),  axis.text = element_text(size=20))
AlphaLowlandScatterplot

png("Figures/AlphaMountainLowlandScatter.png", width = 1000, height = 1000, pointsize = 20)
grid.arrange(AlphaMountScatterplot, AlphaLowlandScatterplot, ncol=1)
dev.off()
```
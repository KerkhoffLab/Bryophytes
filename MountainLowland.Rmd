---
title: "Subsetting Mountains and Lowlands"
author: "Jackie O'Malley '21 and Julia Eckberg '21"
date: "7/25/2019"
output: html_document
---

```{r, message = FALSE}
require(sp)
require(raster)
require(ggplot2)
require(gridExtra)
require(rgdal)
```


#Add continental and mountainous region outlines
```{r, message = FALSE}
nw_mount <- shapefile("Data/MapOutlines/Mountains/Koeppen-Geiger_biomes.shp")
nw_bound <- shapefile("Data/MapOutlines/Global_bound/Koeppen-Geiger_biomes.shp")

LongLatBetaRaster <- readRDS("Data/LongLatBetaRaster.rds")
RichnessRaster <- readRDS("Data/RichnessRaster.rds")
BlankRas <-raster("Data/blank_100km_raster.tif")
CellVec <- c(1:15038)
```


#Creates dataframe including coordinates for each cell
```{r}
LongLatRaster <- setValues(BlankRas, CellVec)
LongLatPoints<-rasterToPoints(LongLatRaster)
LongLatDF <- data.frame(LongLatPoints)
colnames(LongLatDF) <- c("Longitude", "Latitude", "CellID")

coordinates(LongLatDF) <- ~Longitude+Latitude 
proj4string(LongLatDF) <- CRS("+proj=utm +zone=10") 
LongLat <- spTransform(LongLatDF, CRS("+proj=longlat")) 
LongLatDF <- data.frame(LongLat)
LongLatDF[c("Longitude", "Latitude", "CellID")]
LongLatDF <- subset(LongLatDF, select = -c(optional))
saveRDS(LongLatDF, "Data/LongLatDF.rds")
```


#Scatterplot of beta diversity values of cells whose centers are within mountainous regions 
```{r, warning = FALSE}
LongLatDF <- readRDS("Data/LongLatDF.rds")
BetaMount <- extract(LongLatBetaRaster, nw_mount, df = TRUE, cellnumbers = TRUE)

colnames(BetaMount) <- c("Type", "CellID", "Beta")
BetaMount$Type <- "Mountain"

BetaMountVec <- BetaMount$CellID
BetaMount <- merge(BetaMount, LongLatDF)

BetaMountScatterplot <- ggplot() + geom_point(data = BetaMount, aes(Latitude, Beta), shape = 16, size = 5, show.legend = FALSE, alpha=0.5, color = "goldenrod2") + ylab("Mountainous β diversity") + ylim(0.3, 1.0) + xlab("Latitude") + theme_minimal() +  theme(axis.title.y = element_text(size=32), axis.title.x = element_text(size=32),  axis.text = element_text(size=20))
BetaMountScatterplot
```


#Scatterplot of beta diversity values of cells in lowland areas 
```{r, warning = FALSE}
LongLatDF <- readRDS("Data/LongLatDF.rds")

BetaBound <- extract(LongLatBetaRaster, nw_bound, df = TRUE, cellnumbers = TRUE)
colnames(BetaBound) <- c("Type", "CellID", "Beta")

BetaMatch <- BetaBound[BetaBound$CellID %in% BetaMountVec, ]
BetaMatchVec <- BetaMatch[, "CellID"]
BetaLowland <- BetaBound[!BetaBound$CellID %in% BetaMatchVec, ]

BetaLowland$Type <- "Lowland"

BetaLowlandVec <- BetaLowland$CellID
BetaLowland <- merge(BetaLowland, LongLatDF)

BetaLowlandScatterplot <- ggplot() + geom_point(data = BetaLowland, aes(Latitude, Beta), shape = 16, size = 5, show.legend = FALSE, alpha=0.5, color = "cyan4") + ylab("β diversity") + ylim(0.3, 1.0) + xlab("Latitude") + theme_minimal() + theme(axis.title.y = element_text(size=32), axis.title.x = element_text(size=32),  axis.text = element_text(size=20))
BetaLowlandScatterplot

png("Figures/BetaMountainLowlandScatter.png", width = 1500, height = 1000, pointsize = 20)
grid.arrange(BetaMountScatterplot, BetaLowlandScatterplot, ncol=1)
dev.off()
```


#Beta scatterplots combined
```{r, warning = FALSE}
FullBeta <- rbind(BetaMount, BetaLowland)

BetaScatter <- ggplot(data = FullBeta, aes(Latitude, Beta, color=Type)) + 
  geom_point(shape = 16, size = 3, alpha=0.8) + 
  ylab("β diversity") + ylim(0.5, 1.0) + xlab("Latitude") + 
  theme_minimal() + theme(axis.title.y = element_text(size=40), axis.title.x = element_text(size=40),  
                          axis.text = element_text(size=20), legend.text = element_text(size=32), 
                          legend.position = "bottom", legend.title = element_blank()) + 
  scale_color_manual(values = c("cyan4", "goldenrod2")) + geom_smooth(size = 2, show.legend = FALSE)
BetaScatter
```


#Scatterplot of alpha diversity values of cells whose centers are within mountainous regions 
```{r, warning = FALSE}
LongLatDF <- readRDS("Data/LongLatDF.rds")

AlphaMount <- extract(RichnessRaster, nw_mount, df = TRUE, cellnumbers = TRUE)

colnames(AlphaMount) <- c("Type", "CellID", "Alpha")
AlphaMount$Type <- "Mountain"

AlphaBoundVec <- AlphaMount[, "CellID"]
AlphaMount <- merge(AlphaMount, LongLatDF)

AlphaMountScatterplot <- ggplot(AlphaMount, aes(Latitude, Alpha)) + geom_point(shape = 16, size = 5, show.legend = FALSE, alpha=0.5, color = "goldenrod2") + ylab("Mountainous α diversity") + ylim (0, 800) + xlab("Latitude") + theme_minimal() + theme(axis.title.y = element_text(size=32), axis.title.x = element_text(size=32),  axis.text = element_text(size=20))
AlphaMountScatterplot

png("Figures/AlphaBetaMountScatter.png", width = 1000, height = 1000, pointsize = 20)
grid.arrange(AlphaMountScatterplot, BetaMountScatterplot, ncol = 1)
dev.off()
```


#Scatterplot of alpha diversity values of cells in lowland areas 
```{r, warning = FALSE}
LongLatDF <- readRDS("Data/LongLatDF.rds")

AlphaBound <- extract(RichnessRaster, nw_bound, df = TRUE, cellnumbers = TRUE)
colnames(AlphaBound) <- c("Type", "CellID", "Alpha")

AlphaMatch <- AlphaBound[AlphaBound$CellID %in% AlphaBoundVec, ]
AlphaMatchVec <- AlphaMatch[, "CellID"]
AlphaLowland <- AlphaBound[!AlphaBound$CellID %in% AlphaMatchVec, ]

AlphaLowland$Type <- "Lowland"

AlphaLowlandVec <- AlphaLowland$CellID
AlphaLowland <- merge(AlphaLowland, LongLatDF)

AlphaLowlandScatterplot <- ggplot(AlphaLowland, aes(Latitude, Alpha)) + geom_point(shape = 16, size = 5, show.legend = FALSE, alpha=0.5, color = "cyan4") + ylab("Lowland α diversity") + ylim(0, 800) + xlab("Latitude") + theme_minimal() + theme(axis.title.y = element_text(size=32), axis.title.x = element_text(size=32),  axis.text = element_text(size=20))
AlphaLowlandScatterplot

png("Figures/AlphaMountainLowlandScatter.png", width = 1000, height = 1000, pointsize = 20)
grid.arrange(AlphaMountScatterplot, AlphaLowlandScatterplot, ncol=1)
dev.off()
```


#Alpha scatterplots combined
```{r, warning = FALSE}
FullAlpha <- rbind(AlphaMount, AlphaLowland)

AlphaScatter <- ggplot(data = FullAlpha, aes(Latitude, Alpha, color=Type)) + 
  geom_point(shape = 16, size = 3, show.legend=FALSE, alpha=0.8) + 
  ylab("α diversity") + ylim(0, 800) +
  theme_minimal() + theme(axis.title.y = element_text(size=40), axis.title.x = element_blank(),  
                          axis.text = element_text(size=20)) + 
  scale_color_manual(values = c("cyan4", "goldenrod2")) + geom_smooth(size = 2, show.legend = FALSE)
AlphaScatter
```

#SAVE ALPHA AND BETA SCATTERPLOTS :)
```{r}
png("Figures/SCATTER.png", width = 1250, height = 1000, pointsize = 20)
grid.arrange(AlphaScatter, BetaScatter, ncol=1)
dev.off()
```
